<template>
  <div class="slds-grid slds-grid_align-center slds-grid_vertical-align-center">
    <div class="slds-card slds-size_large">
      <div class="slds-card__body slds-card__body_inner">
        <lightning-input
          label="First Name"
          value={firstName}
          name="firstName"
          onchange={handleInput}
        ></lightning-input>
        <lightning-input
          label="Last Name"
          value={lastName}
          name="lastName"
          onchange={handleInput}
          required
        ></lightning-input>
        <lightning-input
          label="Email"
          type="email"
          value={email}
          name="email"
          onchange={handleInput}
          required
        ></lightning-input>

        <div class="slds-m-top_x-large">
          <lightning-button
            variant="brand-outline"
            label="Check for an Existing Company"
            onclick={getAccountByContactEmail}
            stretch
            disabled={isCompanyCheckDisabled}
          ></lightning-button>
        </div>

        <template if:true={matchedAccount}>
          <div class="slds-m-top_large">
            <p>
              Your email is associated with <strong> {matchedAccount}</strong>.
            </p>
          </div>
          <div class="slds-m-top_xx-small">
            <lightning-input
              type="checkbox"
              label="I want to change this company."
              onchange={handleNewAccountCheckboxChange}
            ></lightning-input>
          </div>
        </template>

        <template if:true={accountNotFound}>
          <div class="slds-m-top_large">
            <p>
              We did not find an existing company using your email. Please enter
              a new company below.
            </p>
          </div>
        </template>

        <template if:true={showNewAccountField}>
          <div class="slds-m-top_medium">
            <lightning-input
              type="search"
              label="New Company Name"
              placeholder="Search for or enter a new company"
              value={newAccountName}
              name="newAccountName"
              onchange={handleCompanySearch}
              required
            ></lightning-input>
            <template if:true={companySearchResults.length}>
              <ul
                class="slds-listbox_vertical slds-dropdown slds-dropdown_fluid"
              >
                <template for:each={companySearchResults} for:item="company">
                  <li
                    class="slds-listbox__item"
                    key={company.Id}
                    onclick={handleCompanySelect}
                    data-id={company.Id}
                    data-name={company.Name}
                  >
                    <div
                      class="slds-listbox__option slds-listbox__option_plain"
                    >
                      {company.Name}
                    </div>
                  </li>
                </template>
              </ul>
            </template>
          </div>
        </template>

        <div class="slds-m-top_x-large">
          <lightning-button
            variant="brand"
            label="Sign Up"
            onclick={handleSubmit}
            stretch
            disabled={isSignUpDisabled}
          ></lightning-button>
        </div>

        <div class="slds-m-vertical_large slds-text-align_center">
          <a href="/login" class="slds-text-link"> Already have an account? </a>
        </div>
      </div>
    </div>
  </div>
</template>
