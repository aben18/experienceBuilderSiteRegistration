<template>
  <div class="slds-grid slds-grid_align-center slds-grid_vertical-align-center">
    <div class="slds-card slds-size_large">
      <div class="slds-card__body slds-card__body_inner">
        <lightning-input
          label="First Name"
          name="firstName"
          onchange={handleChange}
        ></lightning-input>
        <lightning-input
          label="Last Name"
          name="lastName"
          onchange={handleChange}
          required
        ></lightning-input>
        <lightning-input
          type="email"
          label="Email"
          name="email"
          onchange={handleChange}
          required
        ></lightning-input>

        <div class="slds-m-top_x-large">
          <lightning-button
            variant="brand-outline"
            label="Check for an Existing Organization"
            onclick={getOrganizationByContactEmail}
            stretch
          ></lightning-button>
        </div>

        <template if:true={organizationSearchedFound}>
          <div class="slds-m-top_large">
            <p>
              Your email is associated with
              <strong> {organizationName}</strong>.
            </p>
          </div>
          <div class="slds-m-top_xx-small">
            <lightning-input
              type="checkbox"
              label="I want to change this organization."
              name="changeOrganization"
              onchange={handleChange}
            ></lightning-input>
          </div>
        </template>

        <template if:true={organizationSearchedNotFound}>
          <div class="slds-m-top_large">
            <p>
              We did not find an existing organization using your email. Please
              enter a new organization name below.
            </p>
          </div>
        </template>

        <template if:true={showNewOrganizationField}>
          <div class="slds-m-top_medium">
            <lightning-input
              type="search"
              label="New Organization Name"
              placeholder="Search for or enter a new organization"
              value={newOrganizationName}
              name="newOrganizationName"
              onchange={handleOrganizationSearch}
              required
            ></lightning-input>
            <template if:true={organizationSearchResults.length}>
              <ul
                class="slds-listbox_vertical slds-dropdown slds-dropdown_fluid"
              >
                <template
                  for:each={organizationSearchResults}
                  for:item="organization"
                >
                  <li
                    class="slds-listbox__item"
                    key={organization.Id}
                    onclick={handleOrganizationSelect}
                    data-id={organization.Id}
                    data-name={organization.Name}
                  >
                    <div
                      class="slds-listbox__option slds-listbox__option_plain"
                    >
                      {organization.Name}
                    </div>
                  </li>
                </template>
              </ul>
            </template>
          </div>
        </template>

        <div class="slds-m-top_x-large">
          <lightning-button
            variant="brand"
            label="Sign Up"
            onclick={handleSubmit}
            stretch
            disabled={isSignUpDisabled}
          ></lightning-button>
        </div>

        <div class="slds-m-vertical_large slds-text-align_center">
          <a href="/login" class="slds-text-link"> Already have an account? </a>
        </div>
      </div>
    </div>
  </div>
</template>
