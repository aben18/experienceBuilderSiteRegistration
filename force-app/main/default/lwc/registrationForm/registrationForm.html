<template>
  <div
    class="slds-grid slds-grid_align-center slds-grid_vertical-align-center slds-p-around_medium"
  >
    <div class="slds-card" style="width: 30rem">
      <div class="slds-card__body slds-card__body_inner">
        <div class="slds-p-around_medium">
          <lightning-input
            label="First Name"
            value={firstName}
            onchange={handleInput}
            name="firstName"
          ></lightning-input>
          <lightning-input
            label="Last Name"
            value={lastName}
            onchange={handleInput}
            name="lastName"
            required
          ></lightning-input>
          <lightning-input
            label="Email"
            type="email"
            value={email}
            onchange={handleInput}
            name="email"
            required
          ></lightning-input>

          <div class="slds-m-top_x-large">
            <lightning-button
              label="Check for an existing Company"
              onclick={getAccountByContactEmail}
              stretch
              disabled={isCompanyCheckDisabled}
            ></lightning-button>
          </div>

          <template if:true={matchedAccount}>
            <div class="slds-m-top_medium">
              <p>
                Your email is associated with
                <strong> {matchedAccount}</strong>.
              </p>
              <lightning-input
                type="checkbox"
                label="I want to change this company."
                onchange={handleNewAccountCheckboxChange}
              ></lightning-input>
            </div>
          </template>

          <template if:true={accountNotFound}>
            <div class="slds-m-top_medium">
              <p>
                We did not find an existing company using your email. Please
                enter a new company below.
              </p>
            </div>
          </template>

          <template if:true={showNewAccountField}>
            <div class="slds-m-top_medium">
              <lightning-input
                label="New Company Name"
                value={newAccountName}
                onchange={handleCompanySearch}
                name="newAccountName"
                type="search"
                placeholder="Search for a company or enter a new one"
                required
              ></lightning-input>
              <template if:true={companySearchResults.length}>
                <ul
                  class="slds-listbox slds-listbox_vertical slds-dropdown slds-dropdown_fluid"
                >
                  <template for:each={companySearchResults} for:item="company">
                    <li
                      key={company.Id}
                      class="slds-listbox__item"
                      onclick={handleCompanySelect}
                      data-id={company.Id}
                      data-name={company.Name}
                    >
                      <div
                        class="slds-listbox__option slds-listbox__option_plain"
                      >
                        {company.Name}
                      </div>
                    </li>
                  </template>
                </ul>
              </template>
            </div>
          </template>

          <div class="slds-m-top_x-large">
            <lightning-button
              variant="brand"
              label="Sign Up"
              onclick={handleSubmit}
              stretch
              disabled={isSignUpDisabled}
            ></lightning-button>
          </div>

          <div class="slds-m-top_large slds-text-align_center">
            <a href="/login" class="slds-text-link">
              Already have an account? Log in here.
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
